%--------------------------------------------
%
% Package pgfplots, library for high-level coordinates.
%
% Copyright 2007/2008 by Christian Feuers√§nger.
%
% This program is free software: you can redistribute it and/or modify
% it under the terms of the GNU General Public License as published by
% the Free Software Foundation, either version 3 of the License, or
% (at your option) any later version.
% 
% This program is distributed in the hope that it will be useful,
% but WITHOUT ANY WARRANTY; without even the implied warranty of
% MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
% GNU General Public License for more details.
% 
% You should have received a copy of the GNU General Public License
% along with this program.  If not, see <http://www.gnu.org/licenses/>.
%
%--------------------------------------------

\pgfutil@usemodule{pgfcalendar}

% Idea: allow
%--------------------------------------------------
% \begin{tikzpicture}
% 	\begin{axis}[
% 		date coordinates in=x,
% 		xticklabel={\day.\month.},
% 	]
% 	\addplot coordinates {
% 		(2008-01-5, 5)
% 		(2008-01-12, 10)
% 		(2008-01-16, 20)
% 	};
% 	\end{axis}
% \end{tikzpicture}
%-------------------------------------------------- 

\def\pgfplots@truncate@to@julian#1.#2\pgfplots@EOI#3{#3=#1\relax}%

\pgfplotsset{
	/pgfplots/date ZERO/.code={%
		\begingroup
		\pgfcalendardatetojulian{#1}\c@pgf@counta
		\edef\pgfmathresult{\the\c@pgf@counta}%
		\pgfmath@smuggleone\pgfmathresult
		\endgroup
		\let\pgfplots@calender@ZEROSHIFT=\pgfmathresult
	},
	date ZERO=2006-01-01,
	/pgfplots/date coordinates in/.style={
		/pgfplots/#1 coord trafo/.code={%
			\begingroup
			\pgfcalendardatetojulian{##1}\c@pgf@counta
			\advance\c@pgf@counta by-\pgfplots@calender@ZEROSHIFT\relax
			\edef\pgfmathresult{\the\c@pgf@counta}%
			\pgfmath@smuggleone\pgfmathresult
			\endgroup
		},
		/pgfplots/#1 coord inv trafo/.code={%
			\begingroup
			\pgfplots@truncate@to@julian##1\pgfplots@EOI{\c@pgf@counta}%
			\advance\c@pgf@counta by\pgfplots@calender@ZEROSHIFT\relax
			\expandafter
			\endgroup
			\expandafter\pgfcalendarjuliantodate\expandafter{\the\c@pgf@counta}\year\month\day
			\edef\pgfmathresult{\year-\month-\day}%
		},
		/pgfplots/#1ticklabel={\tick},%
		/pgfplots/scaled #1 ticks=false,
	},
	/pgfplots/date coordinates in/.value required,
}

